30 октября 2023  Версия 4.30

! исправления багов в D.R
! добавлена совместимость с glibc 2.33+
! в Linux память для словарей должна быть RWX
! "TRAVERSE-WORDLIST" не позволено выдавать скрытые определения
* "IMMEDIATE" модифицирует определение возвращаемое "LATEST-NAME", вместо "LAST @"
+ ALLOCATE-RWX выделяет память, разрешенную для исполнения
+ "NAME>NEXT-NAME" "NAME>STRING" "NAME>CSTRING"  "LATEST-NAME-IN" "LATEST-NAME" "LATEST-NAME-XT"

libs:
! lib/ext/locals.f - определение с локальными переменными было невидимо для "IMMEDIATE" 
+ lib/include/ansi.f - добавлено FILE-STATUS facil.f
+ lib/include/core.f - добавлено "BUFFER:"
+ lib/include/facil.f - добавлено MS


27 марта 2023    Версия 4.29

! исправления багов в QUIT OPEN-FILE-SHARED VOC-LIST WordByAddr 'C"' XSAVE GET-ORDER SFIND
! исправления багов в ?SLITERAL ?SLITERAL2 FIND-FULLNAME ALLOCATE SAVE
! исправление THROW насчет кода ior 109 (он игнорировался)
! ряд исправлений в оптимизаторе
+ IS-TEMP-WORDLIST OS-API
* "ENVIRONMENT?" ищет в ENVIRONMENT-WORDLIST вместо порядка поиска
* оптимизация в SEARCH-WORDLIST
* поддержка UTF-8 BOM в начале файла
* BL WORD трактует любой пробельный символ как разделитель
* скрытие слов macroopt в отдельный списко слов MACROOPT-WL
* сборка: поддержка 64bit Linux host, обновление опций gcc насчет no-pie, автоматическая загрузка бинарника
* авто-определение умолчаний для опций сборки UNIX-ENVIRONMENT and TARGET-POSIX
* разнообразные мелки исправления

libs:
! FS. F.
+ RENAME-FILE COPY-FILE DELETE-FOLDER TRAVERSE-WORDLIST CS-PICK CS-ROLL SYNONYM
* ext/caseins.f больше не зависит от devel


21 января 2009   Версия 4.20

+ порт на Linux (by ~yz)
* исправление "тихого падения при AV во внешних функциях"
* значительно более надёжная обработка системных исключений
* улучшена эвристика WordByAddr
* "isn't unique" дополнительно печатает имя файла
* проверка длины строки со счётчиком
* показывается BUILD-DATE в TITLE
* опции сборки можно указывать в src/sompile.ini
* linux: спец обработка -1 PAUSE (для совместимости с win32)
+ win32: добавлен манифест и VERSIONINFO
* win32: секция экспортов для exe
+ VOC-NAME! VOC-NAME@
+ INCLUDED-EXISTING (для замены INCLUDE-PROBE)
+ FILE-EXISTS (путь существует и не каталог)
* OK корректно показывает стек при отрицательной глубине

libs:
+ include/ansi-block.f - набор слов BLOCK требуемый ANS
+ lib/ext/disasmi.f - интерактивная часть disasm
+ lib/posix/const - генерация файла констант для linux
* много библиотек адаптировано для SPF/Linux

другое:
* документация обновлена
+ пакет для Debian


18 января 2008   Версия 4.19

* улучшения и фиксы оптимизатора
+ внутренние структуры оптимизатора сделаны локальными для потока, что
  позволяет в рантайме корректно компилировать код из разных потоков
* обновлён ассемблер
+ опции компиляции SPF в src/spf_compileoptions.f позволяют :
  ARCH-P6           использовать новые команды процессоров семейства Intel P6
  BUILD-OPTIMIZER   исключить оптимизатор из собираемой системы
  USE-OPTIMIZER     не использовать оптимизатор в процессе сборки
  OPTIMIZE-BY-SIZE  уменьшить размер за счёт отключения выравнивания
! исправлено FLOAT>DATA32
* улучшены некоторые низкоуровневые примитивы
- Теперь TITLE не выводится, если были аргументы командной строки (удобно для скриптов)
+ Много улучшений в обработке исключений
  ! более правильное вычисление области регистров (теперь верно работает под wine и x64)
  + цепочка AT-EXC-DUMP
  + вывод стека данных
  - шестнадцатиричный дамп регистров убран (добавляется через AT-EXC-DUMP)
+ Особая обработка исключения 0xC000013A CONTROL_C_EXIT (Ctrl+C и Ctrl+Break в консоли wine)
+ FATAL-HANDLER -- обработчик непойманного исключения, делает дамп стека возвратов и завершение потока.
! Системные векторы теперь сохраняются между SAVE'ами (раньше переустанавливались в PROCESS-INIT)
* исправлено выравнивание в SHEADER
+ слова длины 0 теперь находятся в словаре
+ VECT IsDelimiter
! улучшен WordByAddr
+ ENUM-VOCS ENUM-VOCS-FORTH FOR-WORDLIST (итераторы по словам и словарям)
+ векторизация VOC-LIST
+ дополнительная ячейка в структуру WORDLIST для расширений и цепочка AT-WORDLIST-CREATING
+ BEHAVIOR! ( не применим к USER-VECT )
+ IS-IMMEDIATE IS-VOC
+ COMMANDLINE-OPTIONS
+ EOLN

либы:
! улучшен lib/ext/caseins.f, понимает [if] [else] [then]
! более строгий разбор синтаксиса в lib/ext/locals.f
- lib/include/float2.f теперь не понимает вещественные числа в формате 12.34d,
  а только 12.34e и 12.34E
+ прекомпилированные константы lib/ext/const.f

документация:
+ расширены intro и devel, добавлены src.ru.html и ans.en.html


1 декабря 2006   Версия 4.18

* Увеличен размер буферов по умолчанию.
! ERROR2 сохраняет и восстанавливает BASE
+ PARSE-NAME синоним NextWord (forth200x)
+ PSKIP синоним SKIP (forth200x)
* Сериализация доступа к хипу будет наследоваться от флага хипа. Для
  по-поточных хипов - без сериализации, для хипа процесса - с.
* Ускорены некоторые слова из ядра
* фиксы в оптимизаторе
! Всегда выдавать номер ошибки в DECIMAL для лучшей читабельности
! NLIST теперь тоже выводит число слов в DECIMAL
+ SEARCH-WORDLIST-NFA CDR-BY-NAME
* Выравнивание тел циклов на ALIGN-BYTES. Для настроек по умолчанию
  (16 bytes) это даёт 3-4% прироста скорости в тестах
* Выравнивание по-умолчанию
* рефакторено выравнивание в CREATED
* рефакторинг ALIGNED
- удалено QCMOVE т.к. CMOVE оптимизировано
* использование CHARS и CHAR+ для лучшей поддержки unicode в будущем
+ CHAR- >CHARS >CELLS (см. CUT-PATH, spf_win_module.f)
* оптимизировано FILE-EXIST
! мелкие багфиксы и улучшения
! Версия 4.18.000

либы:
+ lib/include/ansi.f - совместимость к ANS from Ilya S. Potrepalov
+ lib/include/ansi-file.f - работа с файлами в строгом соответствии с ANS,
                            не рассчитывая на ноль в конце имени файла.
* улучшен вывод float библиотеки
* унифицирован формат файлов прекомпиливанных констант и либы для работы с ним
* улучшен lib/ext/disasm.f - не останавливается на первом встреченном RET

разное:
+ docs/intro
+ docs/devel
+ гламурный NSIS инсталлер ;)


26 января 2006  4.00.0.17:

! фиксы оптимизатора
! фикс вывода в INVALID_HANDLE в H-STDOUT при запуске GUI приложения,
  с учетом багофичи Windows explorer.
+  FNOP  FLOAT>DATA32  DATA>FLOAT32
!  F>D  FINIT  FDROP
-  ?IE ?ZE ?OF
* векторизация SHEADER
! фикс SPACES на отрицательные числа
+ FINIT добавлен в дефолтный обработчик исключений
! упоминания PAD заменены на SYSTEM-PAD
! одинаковое поведение TYPE в Win98 и WinNT в gui приложениях
! фикс возможного переполнения буфера ANSI>
! removed debug info from screen-length
! добавлена проверка в ANSI>OEM OEM>ANSI и HOLD
! слово CUT-PATH не должно изменять поданную на вход строку.
! сравнение адресов беззнаковое в HOLD
! Слово ERROR показывает неизвестные ior'ы тоже. фикс (DECODE-ERROR) (~ruv)


7 сентября 2004

! фикс оптимизатора (что-то с WHILE и R>) (~mac)
! исправлен многократый дамп при аппаратном исключении в потоке или callback (~day)
! теперь SPF exe пакуются UPX и AsProtect, фикс tsave.f (Igor Nikolayenko)
! Правило F0E не учитывало запись в ячейку памяти, при оптимизации двойного
  считывания из этой ячейки памяти. (~mak)
! fix comment for /MOD (~ruv)

+ WINAPI: при ненахождении dll или функции runtime делает ABORT
  новые слова-вектора LIB-ERROR, PROC-ERROR, т.е. можно эту ошибку выводить
  через MessageBox например. (~day)
+ PROCESS-ERR перенесен из TranslateFlow в RECEIVE-WITH-XT элиминировано
  ('исчезнуто') слово (TranslateFlow) и слово (TranslateFlowWith) (~ruv)
+ добалено(факторизация) слово S, и комментарии
+ Значительно улучшена оптимизация кода, особенно в тесте MD5


29 апреля 2004 4.00.015

! два фикса оптимизатора (~mac)
! фикс FM/MOD Serguei V. Jidkov [mailto:jsv@gorod.bryansk.ru]
   3 % -7 =>  0,  3     !! ошибка, должно быть -1, -4
  -3 %  7 =>  0, -3     !! ошибка, должно быть -1,  4
! фикс REFILL (очистка стека если поймали -1002 исключение), факторизация (~ruv)
+ проверка на бесконечный INCLUDE, максимальная глубина 64. (~day)


16 января 2004 4.00.014

! два фикса оптимизатора (~mac)
! откат в API-CALL на размер фрейма стека 60 байт вместо 64.
  (64 не работает с некоторыми dll) (~af)
! фикс FILE-EXIST (~ruv, ~ac)
! THROW теперь реагирует на 109 правильно
! новая схема реагирования на конец входного потока (H-STDIN),
  устранено зависание с http://www.codeproject.com/dialog/quickwin.asp
* HASH переписано и работает как минимум на 50% быстрее и качественнее. (~day)
* AT-PROCESS-STARTING теперь запускается после системной инициализации
  процесса (стеки, переменные, хип).
* Оптимизированы CMOVE FILL, QCMOVE переопределено через CMOVE (~day)
* NON-OPT-WL включен в VOC-LIST (~day)
+ SLIT, (~ruv) факторизация SLITERAL
+ векторизованный поиск по словарю через VECT, для quick-swl.f (~ruv)

  из библиотек хотелось бы отметить ~pinka\spf\quick-swl.f - ускоряющую
  поиск по словарю на порядок


25 сентября 2003  4.00.012

* Обновленный оптимизатор от ~mak.(USPF4M43)
! Исправлены FEXP, FEXPM1. Теперь правильно работают с любыми положительными
  числами. ~af
* Переделан WINAPI:. Теперь все вызовы идут через API-CALL. То есть WINAPI:
  подходит и для cdecl и для stdcall функций. Вариант для stdcall, учитывающий
  количество параметров, перенесен в \LIB\WIN\api-call\altwinapi.f
+ RECURSE теперь работает и в :NONAME словах. ~mak


18 марта 2003  4.00.011

Корректирующий билд:)
* Исправления в оптимизаторе.
! Исправлены F**, FACOS, FASIN. Ввод-вывод плавающей точки сделан в
  десятичной системе (независимо от BASE). ~af
* Факторизован TITLE. (TITLE) печатает инфу без проверок, проверки остались
  в TITLE.
* OPTIONS перенесен в раздел SPF-INIT?. ~ac
! CUT-PATH теперь возвращает строку, заканчивающуюся нулем.


27 февраля 2003  4.00.010

* Обновленный и усиленный оптимизатор от ~mak.
+ Новая иконка. ~yz
* Ассеблерная версия /MOD.
! В код -TRAILING и CMOVE> добавлена инструкция CLD. Без нее применение
  этих слов в WinXP может вызвать крах.
* Слова, принимающие в качестве аргумента строку со счетчиком, определены
  через аналогичные слова, работающие со стоками addr u. ~af
* Переписана часть кода с целью уменьшения количества внутренних переменных.~af
! ?SLITERAL2 правильно обрабатывает попытку инклюдить слова
  содержащие символы ? и *. ~af
! Длина буфера INPUT_RECORD удвоена. ~ruvim
+ Добавлены векторы FIND-FULLNAME и PROCESS-ERR. Теперь в INVLUDED используется
  три вектора: FIND-FULLNAME - интеллектуальный поиск подключаемого файла;
  (INCLUDED) - трансляция файла; PROCESS-ERR - обработка ошибки трансляции.
- Удалено слово +SourcePath.


10 ноября 2002  4.00.009

+ Обновленный оптимизатор от ~mak.
+ Новый SEH. ~ac
! Исправлен READ-LINE. ~ac
! SAVE генерирует более правильный (с точки зрения WinXP) заголовок файла.
  При этом создается программа, не содержащая ресурсов.
  Если необходимы ресурсы, то можно использовать src\tsave.f :
  S" name.exe" S" src\spf.fres" src\tsave.f
! CONSOLE-HANDLES перенесен в начало цикла QUIT.


5.July.2002 4.00.008

+ Вместо ручного подключения иконок, ресурсы подключаются по технологии ~yz
  из spf.fres.
! Вставка символов перевода строки в лог перенесена из MAIN1 в ACCEPT1,
  а то лог странно выглядел.
+ Вместо константы #ST-RES введена переменная ST-RES - размер стека данных.
  По умолчанию размер стека данных - около 4Кб. ~af
! Добавлена потерянная в 7 билде система вывода ошибок от ~ruvim.
+ Большой пакет изменений из uspf4m10-uspf4m13 ~mak
- Убрана переменная ERASED-CNT. Вместо нее введено слово PROCESS-INIT.
* Ширина колонок в WORDS изменена с 8 до 15.
! RECEIVE-WITH выделяет теперь для TIB  C\L+2 байта. REFILL передает READ-LINE
  в качестве буфера TIB размером C\L, а READ-LINE требует чтобы буфер реально
  содержал на два байта больше чем объявлено.
* Снова используется асм-версия DIGIT, понимающая только большие буквы.
  Case-нечувствительный DIGIT перенесен в либу caseins.
+ Добавлена переменная SOURCE-ID-XT - хранит xt слова, считывающего из
  SOURCE-ID одну строку. Необходима в том случае, когда SOURCE-ID не файл,
  а например область памяти. ~af
- Все слова для работы с потоками ввода-вывода вынесены в отдельную либу.
+ (INCLUDED) стал векторным.
+ INCLUDED от ~ruvim - подключение файла по относительному "текущему" каталогу.
- Из ядра убраны несколько не используемых функций Windows.
+ Добавлено слово .TO-LOG - печатает верхнее число на стеке в лог-файл.
* Изменен WINAPI: - добавлено поле содержащее количество параметров, которые
  передаются функции. Это число вычисляется при первом вызове функции. ~ruvim
! Слово ; очищает буфер JpBuff в оптимизаторе.
! Учтено возможное наличие символа tab в исходниках. Изменены - REQUIRE,
  LAST-WORD.
! Изменена обработка hex-констант. Если следующая за 0x часть токена
  содержит символы, не являющиеся 16-ричными цифрами, то токен не считается
  hex-константой. Исключение - в конце константы может стоять буква L.


Сборка 7

! по умолчанию замена call ret в программе не производиться.
  ?C-JMP=FALSE
  Форт система откомпилирована с ?C-JMP=TRUE
! Процедуры ANSI>OEM и наоборот работают теперь с буфером, на случай:
  S" asd" ANSI>OEM чтобы не было многократных перекодировок.
! Пофиксен баг в INCLUDED, система вывода ошибок переписана by ~ruvim
+ Сообщение isn't unique выводиться только для CONTEXT словаря.
  Безусловно, несколько пострадала информативность, но в предыдущей версии
  из-за большого количества этих сообщений на них никто не смотрел...
+ Case нечуствительность в lib\ext\caseins.f и новом DIGIT
! Подправлено ~yz/automation.f
+ ~day/mysql

note: Люди, не делайте так: 0 LIT, HERE CELL-


Сборка 6

! баг в инициализации (обнаружился в acProxy)
! баг в SAVE (уже второй since 3.75... )
+ Улучшена оптимизация UNTIL и ?BRANCH, (~mak)
+ cfa высокоуровневых слов форт системы выровнены на 4
+ Оптимизатор автоматически заменяет call ret на jmp (кроме RECURSE)
+ Вывод ошибок снова идет в H-STDOUT - удобно для отладки.
* PERCEIVE-WITH -> RECEIVE-WITH
+ новая gui консоль spf4wc (A. Filatkin+все,все,все...)
+ Слово SKIP1 в парсере. Очень полезное слово при любом парсинге.

from ~mak:
* псевдо-векторный INTERPRET (see &INTERPRET)
+ FIELD - аналог --

note: не забудьте перед сохранением многопоточных приложений сделать
      0x100 EXTRA-MEM дабы ваша программа не жрала памяти больше чем нужно.
      (особенно всяким серверам)


Сборка 5

+ Слово PERCEIVE-WITH ( i*x addr u xt -- j*x ior )
  Сделать addr u - входным буфером, выполнить xt по CATCH
  Если exception #TIB >IN и CURSTR не восстанавливаем!
  Используетя в INCLUDE-FILE DECODE-ERROR ENVIRONMENT?


Сборка 4

! баг в SAVE - сработал при определенных условиях
! баг в DECODE-ERROR - неверное сообщение о неизвестной ошибке
! заработало C" в целевом компиляторе

+ Оптимизация слов, созданных --
+ Добавлена забытая оптимизация USER-VALUE
+ Добавлены слова для работы с потоками в файл Win\spf_win_io.f
  Примерно в 8 раз возросла скорость REFILL (причем мы обогнали MSVCRT)

+ H-STDIN и SOURCE-ID стали потоками чтения, а не файлами.
  Это значит, что
  - операции чтения происходят поблочно
  - reposition при чтении строки не делается
  - не стоит обращаться к потокам ф-ми работы с файлами.
    Нужно использовать слова STREAM-FILE ( s -- h ) и
    FILE>RSTREAM ( h -- s )
    (например нужно исправить библиотеки ~ac\lib\str*.f -
     слово PARSE" перед FILE-SIZE поставить STREAM-FILE)

  По умолчанию размер value буфера RSTREAM-BUF определен 512 байт.
  Операция чтения из потоков чтения - виртуальная (!). Подробности
  смотрите в реализации.
  СПФорт теперь может запросто играть роль telnet сервера

* Новая версия макрооптимизатора (~mak)


Сборка 03

+ Новый оптимизатор, использующий кольцевой буфер, а не реверс (~mak)
* MAIN1 возвращен в состояние spf3 (~ruvim)
+ spfgui 0.2 запоминает историю ввода, слушается клавиш влево/вправо/home/end
  /delete а также вывод ускорен на Win98
  примерно на 30%, на Win NT/2000 примерно на 125%
  (железо с аппаратным ускорением).
+ LOOP REPEAT AGAIN учитывают short branch
+ lib\ext\locals.f оптимизируют получение адреса локальной переменной
+ Слово QCMOVE - копирует словами, а не байтами, используется в MOVE
* NOTFOUND больше не меняет >IN перед THROW (~ss)
* ENVIRONMENT? и DECODE-ERROR не выделяют дополнительных буферов.
* Синтаксис :: работает для всех слов, возвращающих wid, а не только
  для VOCABULARY
  например:
  WORDLIST CONSTANT test
  ...
  test::xxx
  Но не разрешаются такие конструкции: FORTH::DUP::DUP
+ VALUE переменная NEW-WINAPI? ( -- f )
  Если f=true то слово WINAPI: имеет синтаксис
  число_параметров WINAPI: имя_слова имя_функции имя_dll
  например:
     1  WINAPI: RegisterClassEx RegisterClassExW USER32.DLL
  Данный синтаксис поддерживается ds-forth и рекомендуется к использованию
  в целях улучшения переностимости форт-программ.
+ По S" FORTH-SYS" ENVIRONMENT? возвращает строку SP-FORTH
  По S" FORTH-MAJOR" возвращает major версию форт системы
  По S" FORTH-DATE" возвращает строку, означающую дату сборки,
  например: 29.Jan.2001

Note: начиная с данной версии спф будет поставляться с пустой /devel
и с пустой /samples директориями. Оные будут формироваться и поставляться
отдельно от спф.
СПФ берет курс на пополнение каталога /lib - сюда будут включаться
общепризнанные, отлаженные и не конфликтующие между собой
библиотеки разных производителей из /devel
В далеком будущем каталог /lib возможно будет перенесен в отдельный пакет...

Сборка 02

* Установки атрибутов консоли переехали из CONSOLE-HANDLES в spf.ini
* Из AT-PROCESS-FINISHING убрано DESTROY-HEAP (если были ошибки при работе
  с хипом, в этой строчке могло быть зависание программы)
! WORD теперь реентерабельно и пользуется SYSTEM-PAD вместо HERE
  Введено слово SYSTEM-PAD - дает начало области форматного
  преобразования. Следующие условия очень маловероятны:
  1. Нужен результат WORDS
  2. Одновременно нужен результат форматного преобразования, причем
     этот результат превышает 4096-255=3840 байт (форматное преобразование
     заполняет свой буфер с конца).
! баг в DECODE-ERROR - использовался ?SLITERAL когда в STATE был
  режим компиляции... (~micro)


Версия 4 Сборка 01

+ В CONSOLE-HANDLES установка атрибутов окна. На случай extcomm+windows98
+ новая версия spfgui - протестировано в Windows98. Эх, MS, MS :)


11.Jan.2001

+ При компиляции spf не подключается spf.ini
  (OPTIONS выполняются до SPF-INI)
+ Похорошел промт форт системы
* <EOF> заменено на \EOF (заодно изменен алгоритм)
+ Переход на spf 4.0 и CVS
+ Слово BUILD-DATE ( -- T ) где T - counted string соответствующая
  дате последней сборки.
! Исправлены ERROR2 и OPTIONS. Попробуйте на спф такую конструкцию:
  OPTIONS BYE
! Добавлена установка ConsoleMode. Предохраняет от ошибок при чтении с консоли
  при запуске форта другим процессом (например extcomm плагин для фара).
  (~micro)
+ KEY ACCEPT TYPE стали векторными. Удобно для подключения GUI например,
  и вообще любого контроля за вводом/выводом.
! Исправлен серьезный баг в tc_spf.f
+ Слово USER-VECT ( "name" -- )
+ Слово ERROR2 факторизовано.
  Слово DECODE-ERROR ( n u -- c-addr u ) Note: использует PAD
  где u - константа FORTH_ERROR либо другая определенная пользователем.
  см. также lib\windows\winerr.f
+ USER-VALUE инлайнится (~mak)
+ Слово USER-INIT факторизовано, выделено слово POOL-INIT ( n -- )
* Область форматного преобразования _всегда_ заканчивается нулем.
  Используется при передаче строки ф-ям Windows. Смотрите обновленный
  пример ~day\joop\samples\clock.f
* Слова ANSI>OEM и OEM>ANSI НЕ использут PAD. Все равно там не Unicode
  ф-ии используются...




Значки в whatnews.txt:
======================

* - изменение без потери или приобретения функциональности
! - исправление ошибки
+ - добавление новых функций
- - удаление

Developers:

~ruvim   = Ruvim Pinka          ruvim@forth.org.ru
~boa     = Bordachev Andrej     glareboa@mail.ru
~day     = Dmitry Yakimov       ftech@tula.net
~micro   = Dmitry Zyryanov      micro@forth.org.ru
~1001    = Konstantin Tarasov   const@penza.com.ru
~ac      = Andrey Cherezov      andrey@cherezov.koenig.su
~nemnick = Nicholas Nemtsev     nn@vdk.psc.ru
~mak     = Michael Maximov      mak@mail.rtc.neva.ru
~yz      = Yuriy Zhilovets      yz@forth.org.ru
~mlg     = Michael Gassanenko   mlg@forth.org
~af      = Andrey Filatkin      af@forth.org.ru
~oleg_sh = Oleg Shalyopa
~trasher = Dmitry Bobrik

Igor Nikolayenko <in4@forth.org.ru>
